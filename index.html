<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#111827" />
  <title>ì•„ë¥´í…Œí¬ â€” ëª¨ë°”ì¼ ì „ìš© ìƒ˜í”Œ</title>
  <style>
    :root { --bg:#0b1220; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#38bdf8; }
    *{box-sizing:border-box} html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Apple SD Gothic Neo","Noto Sans KR",Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
    .wrap{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:24px}
    .card{width:100%;max-width:440px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:24px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .pad{padding:20px}
    h1{font-size:20px;margin:0 0 6px}
    p{margin:8px 0;color:var(--muted);line-height:1.5}
    button,input[type=file]{appearance:none;border:0;border-radius:14px;padding:14px 16px;background:var(--accent);color:#06121a;font-weight:700;cursor:pointer; display: block; margin: 0 auto;}
    .row{display:flex;gap:12px;align-items:center}
    .hidden{display:none !important}
    .notice{padding:16px;border-radius:14px;background:#181f2f;border:1px solid rgba(255,255,255,.06);color:var(--text)}
    .qr{width:140px;height:140px;border-radius:12px;background:conic-gradient(from 90deg,#111 0 25%,#222 0 50%,#111 0 75%,#222 0);display:flex;align-items:center;justify-content:center;color:#fff;opacity:.75}
    .footer{margin-top:16px;color:var(--muted);font-size:12px;text-align:center}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);margin:16px 0}
    .ghost{opacity:.55}
  </style>
</head>
<body>
  <div id="app" class="wrap">
    <div class="card">
      <div class="pad">
        <h1>ì•„ë¥´í…Œí¬ â€” ëª¨ë°”ì¼ ì „ìš© ìƒ˜í”Œ</h1>
        <p class="ghost">ê³¨ë™í’ˆ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ë©´ AI 1ì°¨ ê°ì • ê²°ê³¼ ìš”ì•½ì„ ë³´ì—¬ì£¼ëŠ” ë°ëª¨ í™”ë©´ì…ë‹ˆë‹¤.</p>
        <div class="divider"></div>

        <!-- Desktop/Large-screen lock -->
        <div id="desktopLock" class="notice hidden">
          <p style="font-weight:700">ì´ ì„œë¹„ìŠ¤ëŠ” ëª¨ë°”ì¼ ì „ìš©ì…ë‹ˆë‹¤ ğŸ“±</p>
          <p>ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ì•„ë˜ ì£¼ì†Œë¥¼ ì—´ì–´ ì ‘ì†í•˜ì„¸ìš”.</p>
          <div class="row" style="margin:12px 0;justify-content:space-between">
            <div>
              <p class="ghost" style="margin:0">í˜„ì¬ í˜ì´ì§€ URL</p>
              <p id="pageUrl" style="word-break:break-all"></p>
            </div>
            <div class="qr" aria-hidden="true">QR</div>
          </div>
          <p class="footer">â€» ê°œë°œÂ·ì‹¬ì‚¬ìš©ìœ¼ë¡œ PCì—ì„œ í™•ì¸ì´ í•„ìš”í•˜ë©´ <code>?allowDesktop=1</code> ë˜ëŠ” <code>#force</code> ë¥¼ URL ë’¤ì— ë¶™ì´ì„¸ìš”.</p>
        </div>

        <!-- Mobile UI -->
        <div id="mobileUI" class="hidden">
          <p style="margin-top:0">ìƒ˜í”Œ ì…ë ¥</p>
          <div style="text-align:center">
            <input id="file" type="file" accept="image/*" capture="environment" />
          </div>
          <div id="preview" style="margin-top:12px"></div>
          <div class="divider"></div>
          <p style="margin:8px 0 6px">ğŸ” ë‚´ DBì—ì„œ ì°¾ê¸°</p>
          <div class="row" style="gap:8px">
            <input id="q" type="text" placeholder="í‚¤ì›Œë“œ/ì‘í’ˆë²ˆí˜¸ ê²€ìƒ‰ (ì˜ˆ: ë°±ì, ì²­ì, J-2023-001)" style="flex:1;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#0f172a;color:var(--text)"/>
            <button id="btnSearch" type="button">ê²€ìƒ‰</button>
          </div>
          <div id="searchInfo" class="ghost" style="font-size:12px;margin-top:6px">ë ˆí¬ ë£¨íŠ¸ì— <code>db.json</code> íŒŒì¼ì„ ë‘ë©´ ìë™ìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
          <div id="list" style="margin-top:12px"></div>
          <div id="result" class="notice hidden" style="margin-top:12px"></div>
        </div>

        <div class="footer">Â© Artech â€” demo</div>
      </div>
    </div>
  </div>

  <script>
    // --- Mobile-only gate (client side) ---
    (function(){
      const ua = navigator.userAgent || navigator.vendor || window.opera;
      // Include KakaoTalk / Kakao Browser signatures
      const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|KAKAOTALK|KAKAOBROWSER/i.test(ua);
      const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      const smallScreen = Math.min(window.innerWidth, window.innerHeight) <= 1024;
      const url = new URL(window.location.href);
      const allowDesktop = url.searchParams.get('allowDesktop') === '1' || url.hash.includes('force');

      const mobileUI = document.getElementById('mobileUI');
      const desktopLock = document.getElementById('desktopLock');
      document.getElementById('pageUrl').textContent = window.location.href.split('?')[0];

      const pass = ((isMobileUA || hasTouch) && smallScreen) || allowDesktop;
      if(pass){ mobileUI.classList.remove('hidden'); }
      else { desktopLock.classList.remove('hidden'); }

      // Debug panel to inspect detection states
      if (url.hash.includes('debug')) {
        const dbg = document.createElement('pre');
        dbg.style.padding='12px';
        dbg.style.background='#0f172a';
        dbg.style.border='1px solid rgba(255,255,255,.08)';
        dbg.style.borderRadius='12px';
        dbg.style.marginTop='12px';
        dbg.textContent = [
          `UA: ${ua}`,
          `isMobileUA: ${isMobileUA}`,
          `hasTouch: ${hasTouch}`,
          `smallScreen: ${smallScreen} (${window.innerWidth}x${window.innerHeight})`,
          `allowDesktop: ${allowDesktop}`,
          `PASS: ${pass}`
        ].join('\n');
        document.querySelector('.pad').appendChild(dbg);
      }
    })();

    // --- Very lightweight demo logic ---
    (function(){
      const fileInput = document.getElementById('file');
      const preview = document.getElementById('preview');
      const result = document.getElementById('result');
      if(!fileInput) return;

      fileInput.addEventListener('change', async (e) => {
        const file = e.target.files && e.target.files[0];
        if(!file) return;
        // show preview
        const img = new Image();
        img.src = URL.createObjectURL(file);
        img.alt = 'ì—…ë¡œë“œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°';
        img.style.maxWidth = '100%';
        img.style.borderRadius = '14px';
        img.onload = () => URL.revokeObjectURL(img.src);
        preview.innerHTML = '';
        preview.appendChild(img);

        // 1) íŒŒì¼ëª…(í™•ì¥ì ì œì™¸)ìœ¼ë¡œ DB ìë™ê²€ìƒ‰ ì‹œë„
        const base = (file.name || '').split('.')[0];
        if (window.searchDBThenRender && window.searchDBThenRender(base)) {
          // ë§¤ì¹­ë˜ì–´ DB ê²°ê³¼ê°€ ê·¸ë ¤ì¡Œìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ ë!
          return;
        }

        // 2) ë§¤ì¹­ ì‹¤íŒ¨ ì‹œì—ë§Œ ìƒ˜í”Œ ë¬¸êµ¬ í‘œì‹œ (fallback)
        result.classList.remove('hidden');
        result.innerHTML = '<strong>AI 1ì°¨ ê°ì •(ìƒ˜í”Œ)</strong><br>â€¢ ìœ í˜•: ë„ìê¸°(ì¶”ì •)<br>â€¢ ì‹œëŒ€: ì¡°ì„  í›„ê¸°(ì¶”ì •)<br>â€¢ ìœ ì‚¬ ì‚¬ë¡€: 3ê±´ ë§¤ì¹­<br><span class="ghost">â€» ë°ëª¨ í…ìŠ¤íŠ¸ â€” ì¶”í›„ ì‹¤ì œ ëª¨ë¸ ì—°ë™</span>';
      });
    })();
  </script>
  <script>
    // --- Lightweight DB search module ---
    (function(){
      const fileInput = document.getElementById('file');
      const preview   = document.getElementById('preview');
      const result    = document.getElementById('result');
      const q         = document.getElementById('q');
      const btnSearch = document.getElementById('btnSearch');
      const list      = document.getElementById('list');
      const searchInfo= document.getElementById('searchInfo');
      if(!q || !btnSearch) return;

      let DB = [];
      // 1) db.json ë¡œë“œ (ë£¨íŠ¸ì— ë‘ë©´ ./db.json ê²½ë¡œ)
      fetch('./db.json', {cache:'no-store'})
        .then(r => r.ok ? r.json() : [])
        .then(json => {
          DB = Array.isArray(json) ? json : (json.items || []);
          if(DB.length){ searchInfo.textContent = `DB ë¡œë“œë¨: ${DB.length}ê±´`; }
        })
        .catch(()=>{ searchInfo.textContent = 'db.jsonì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì„ íƒì‚¬í•­)'; });

      // ë Œë”ë§ ìœ í‹¸
      function renderItem(it){
        result.classList.remove('hidden');
        result.innerHTML = `
          <strong>${it.name||'ì œëª© ì—†ìŒ'}</strong><br>
          â€¢ ìœ í˜•: ${it.type||'-'}<br>
          â€¢ ì‹œëŒ€/ì—°ëŒ€: ${it.era||'-'}<br>
          â€¢ ì†Œì¥ë²ˆí˜¸: ${it.code||'-'}<br>
          <div style="margin-top:8px">${(it.desc||'').replace(/\n/g,'<br>')}</div>
          ${it.images && it.images.length
            ? `<div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
                ${it.images.slice(0,4).map(src=>`<img src="${src}" alt="ref" style="width:72px;height:72px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.1)">`).join('')}
              </div>`
            : '' }
        `;
      }
      function renderList(items){
        list.innerHTML = '';
        if(!items.length){ list.innerHTML = '<p class="ghost">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
        const frag = document.createDocumentFragment();
        items.slice(0,20).forEach(it => {
          const card = document.createElement('div');
          card.className = 'notice';
          card.style.cursor = 'pointer';
          card.style.marginTop = '8px';
          card.innerHTML = `<div style="display:flex;align-items:center;gap:10px">
            ${it.thumbnail ? `<img src="${it.thumbnail}" alt="thumb" style="width:56px;height:56px;object-fit:cover;border-radius:8px;border:1px solid rgba(255,255,255,.1)">` : ''}
            <div>
              <div style="font-weight:700">${it.name||'(ì œëª© ì—†ìŒ)'}</div>
              <div class="ghost" style="font-size:12px">${[it.code,it.type,it.era].filter(Boolean).join(' Â· ')}</div>
            </div>
          </div>`;
          card.addEventListener('click',()=> renderItem(it));
          frag.appendChild(card);
        });
        list.appendChild(frag);
      }
      function searchDB(keyword){
        const kw = (keyword||'').trim().toLowerCase();
        if(!kw){ list.innerHTML = '<p class="ghost">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</p>'; return; }
        const items = DB.filter(it => {
          const hay = `${it.name||''} ${it.type||''} ${it.era||''} ${it.code||''} ${it.desc||''}`.toLowerCase();
          return kw.split(/\s+/).every(k => hay.includes(k));
        });
        renderList(items);
      }

      btnSearch.addEventListener('click', ()=> searchDB(q.value));
      q.addEventListener('keydown', e => { if(e.key==='Enter') searchDB(q.value); });

      // ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œ íŒŒì¼ëª…ìœ¼ë¡œ ìë™ ê²€ìƒ‰(ì„ íƒ)
      fileInput?.addEventListener('change', e => {
        const file = e.target.files && e.target.files[0];
        if(!file) return;
        const img = new Image();
        img.src = URL.createObjectURL(file);
        img.alt = 'ì—…ë¡œë“œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°';
        img.style.maxWidth = '100%';
        img.style.borderRadius = '14px';
        img.onload = () => URL.revokeObjectURL(img.src);
        preview.innerHTML = '';
        preview.appendChild(img);

        const base = (file.name||'').split('.')[0];
        if(DB.length && base){ searchDB(base); }
      });
    })();
    window.searchDBThenRender = (kw) => {
      const keyword = (kw||'').trim().toLowerCase();
      if(!keyword) return false;
      const items = DB.filter(it => {
        const hay = `${it.name||''} ${it.type||''} ${it.era||''} ${it.code||''} ${it.desc||''}`.toLowerCase();
        return keyword.split(/\s+/).every(k => hay.includes(k));
      });
      if(items.length){
        renderList(items);
        // ì²« í•­ëª© ìƒì„¸ë¥¼ ë°”ë¡œ ì¶œë ¥(ì›í•˜ë©´ í´ë¦­ ìœ ë„ë§Œ í•˜ê³  ì‹¶ìœ¼ë©´ ì´ ì¤„ì„ ë¹¼ë„ ë¨)
        renderItem(items[0]);
        return true; // ì°¾ì•˜ë‹¤!
      }
      return false; // ëª» ì°¾ì•˜ë‹¤
    };
  </script>
</body>
</html>
